'use strict';

var crypto = require('crypto');
var expect = require('chai').expect;
var RandomStream = require('../lib/random-stream');

describe('RandomStream', function() {

  it('should stream n bytes of random data', function(done) {
    var noise = new RandomStream({ length: 512, size: 8 });
    var bytes = 0;

    noise.on('data', function(data) {
      bytes += data.length;
    }).on('end', function() {
      expect(bytes).to.equal(512);
      done();
    });
  });

  it('should emit chunks of m size', function(done) {
    var noise = new RandomStream({ length: 512, size: 8 });
    var bytes = 0;

    noise.on('data', function(data) {
      expect(data).to.have.lengthOf(8);
    }).on('end', done);
  });

  it('should keep a hash of the data streamed', function(done) {
    var noise = new RandomStream({ length: 512, size: 8 });
    var bytes = 0;
    var hash = crypto.createHash('sha256');

    noise.on('data', function(data) {
      hash.update(data);
    }).on('end', function() {
      expect(hash.digest('hex')).to.equal(this.hash.toString('hex'));
      done();
    });
  });

});
